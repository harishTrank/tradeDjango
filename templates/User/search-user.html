{% extends "index.html" %} {% block content %}

<div class="tab-content" id="search-user">
    <div class="user-table search-user">
        <div class="seach-area" style="margin-top:10px;">
            <label for="user-search-input">Search User:</label>
            <input type="search" id="user-search-input">
        </div>
        <div class="outcome-user">

            <ul id="searchUserUlId">
            </ul>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const user_type = "{{request.user.user_type}}"
    $(document).ready(function () {
        function loadAllUsers() {
            $.ajax({
                url: '{% url 'search-user-api' %}',
                method: 'GET',
                success: function (data) {
                    if (user_type !== "SuperAdmin") {
                        data.data.map(mapItem =>
                            $("#searchUserUlId").append(`
                                <ul>
                                    <li>
                                        <a href="#">${mapItem.master_user_details.user_name}</a>
                                        <ul>
                                            ${mapItem.clients.map(child => `<li>${child.client_user_details.user_name}</li>`).join('')}
                                        </ul>
                                    </li>
                                </ul>`)
                        );
                    } else {
                        data.data.map(mapItem =>
                            $("#searchUserUlId").append(`
                                <ul>
                                    <li>
                                        <a href="#">${mapItem.user_details.user_name}</a>
                                        <ul>
                                            ${mapItem.masters.map(master => `<li><a href="#">${master.master_user_details.user_name}</a>
                                                                            <ul>
                                                                                ${master.clients.map(child => `<li>${child.client_user_details.user_name}</li>`).join('')}
                                                                            </ul></li>`)
                                            .join('')}
                                        </ul>
                                        <ul>
                                            ${mapItem.clients.map(child => `<li>${child.client_user_details.user_name}</li>`).join('')}
                                        </ul>
                                    </li>
                                </ul>`)
                        );
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
        loadAllUsers();
    
        // Event delegation for click
        $('#searchUserUlId').on('click', 'li > a', function (e) {
            e.preventDefault();
            var li = $(this).parent('li');
            if (!li.has('ul')) {
                return;
            }
            li.children('ul').toggle();
        });
    });


    $('#user-search-input').on('input', function () {
        var searchTerm = $(this).val().toLowerCase();
        $('#searchUserUlId li').each(function () {
            var userText = $(this).text().toLowerCase();
            if (userText.indexOf(searchTerm) === -1) {
                $(this).hide();
            } else {
                $(this).show();
            }
        });
    });
    

</script>



{% endblock content %}
