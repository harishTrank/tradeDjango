{% include "components/new-tab/user-header.html" %}
{% load static %}{% block newtab %}

<div class="tab-content" id="quantitysetting">
    <div class="trade-btm">
        <div class="mb-10">
            <label for="">Exchange:</label>
            <select name="exchange_name" id="selectedExchangeId" style="width: 250px;" class="form-control">
              {% for i in exchange %}
                  {% if i.symbol_name == "MCX" %}
                      <option value="MCX">MCX</option>
                  {% elif i.symbol_name == "NSE" %}
                      <option value="NSE">NSE</option>
                  {% elif i.symbol_name == "MINI" %}
                      <option value="MINI">MINI</option>
                  {% endif %}
              {% endfor %}
            </select>
            <input type="submit" value="Edit" class="form-btn mr" style="border: 1px solid white;">
        </div>
    </div>
    <div class="user-table col-100" style="width: 55%;">
        <table style="width: 100%;">
            <tr>
                <th>Script</th>
                <th>Lot Size</th>
                <th>Lot Max</th>
                <th>Breakup Qty</th>
                <th>Breakup Lot</th>
                <th>Last Updated</th>
            </tr>

            <tbody id="quantityTableBody">
             
            </tbody>
        </table>
    </div>
</div>


<script>

  const apiCallForAllExchange = () => {
    const selectedExchange = $("#selectedExchangeId").val(); 
   
  
    $.ajax({
      type: "GET",
      url: `{% url 'web-script-quantity-api' %}?id={{id}}&searchInput=${selectedExchange}`, // Pass the selected value as 'id'
      success: function (data) {
        console.log(data);
        $("#quantityTableBody").empty();
        data.response.map(item => {
          const createdAt = new Date(item.created_at);
          const formattedDate = `${createdAt.getMonth() + 1}/${createdAt.getDate()}/${createdAt.getFullYear()} ${createdAt.getHours()}:${createdAt.getMinutes()}:${createdAt.getSeconds()}`;
          $("#quantityTableBody").append(`
            <tr>
              <td>${item.ex_change === "NSE" ? item.identifier : item.identifier.split("_")[1]}</td>
              <td>${item.max_qty}</td>
              <td>${item.max_lot}</td>
              <td>${item.breakup_qty}</td>
              <td>${item.breakup_lot}</td>
              <td>${formattedDate}</td>
            </tr>
          `);
        });
      
      },
      error: function (xhr, status, error) {
        console.error('Error:', error);
      }
    });
  }
  
  $('#selectedExchangeId').on('change', function() {
    apiCallForAllExchange(); // Trigger API call when the selection changes
  });
  
  apiCallForAllExchange();
</script> 


{% endblock newtab %}
