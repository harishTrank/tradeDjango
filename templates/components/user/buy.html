<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
       a:active {
         color: blue;
       }

       #buyWatchId {
         display: none;
       }

       .change-pass {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.5);
       }

       * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
       }
       .spaceclass {
         justify-content: space-evenly;
       }
       .flex {
         display: flex;
         flex-wrap: wrap;
       }
       .space-bw {
         justify-content: space-between;
       }
       .align-center {
         align-items: center;
       }
       .text-center {
         text-align: center;
       }
       .white-back {
         background: #fff;
         box-shadow: 0px 4px 20px 0px rgba(0, 0, 0, 0.1);
       }

       .create-profile {
         position: fixed;
         top: 0;
         left: 0;
         background: rgba(0, 0, 0, 0.5);
         width: 100%;
         height: 100%;
         z-index: 99;
       }
       .create-profile-inside {
         width: 80%;
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         z-index: 999;
         background: #e7e7e7;
         border-radius: 10px;
       }
       .admin-right i {
         margin-right: 8px;
         color: #0000FF;
         font-size: 10px;
         margin-top: 2px;
       }
       .top-body {
         background-color: #fff;
         padding: 8px;
         border-top-left-radius: 10px;
         border-top-right-radius: 10px;
       }
       .middle-body {
         padding: 15px;
       }
       .inner-middle-body {
         padding: 6px;
         border:none;


       }

       .save-cancel-btn {
         padding: 0px 75px;
       }
       .save-cancel-btn button:first-child {
         background-color: #008000;
         padding: 2px 10px;
         color: #fff;
         border: none;
       }
       .save-cancel-btn button:last-child {
         background-color: #221b1b;
         padding: 10px 20px;
         color: #fff;
         border: none;
       }
       .input-tags input {
         padding: 3px 6px;
         margin: 0px 6px;
         border: 1px solid black;
         background-color: #e7e7e7;
         border-radius: 4px;
       }
       .mrg-tb {
         margin: 8px 0px;
       }
       .pop-up-text p {
         font-size: 16px;
         font-weight: 600;
       }
       .limit p {
         margin-right: 25px;
       }
       .limit div:first-child {
         margin-right: 20px;
       }
       .clients p {
         margin-right: 8px;
       }
       .btns button:first-child {
         margin-right: 10px;
         padding: 10px 20px;
       }
       .client-name{
           display: flex;
           flex-direction: column;
           width: 19%;


       }
       .client-name select,input{
           {% comment %} margin-top: 5px; {% endcomment %}
           padding:2px;
           border: 1px solid #000;
       }
       .submit-btn{

           display: flex;
           flex-direction: column;
           width: 19%;

       }
      .submit-btn input{
       {% comment %} margin-top: 5px; {% endcomment %}
       padding: 4px;
       background: #008000;
           color: #fff;
           border: 1px solid #fff;
           font-weight: bold;
      }
      .cancel-finalbtn input{
       margin-top: 5px;
       padding: 4px;
       background: #000;
           color: #fff;
           border: 1px solid #fff;
           font-weight: bold;
      }
      .cancel-finalbtn{
       display: flex;
           flex-direction: column;
           width: 19%;
      }
      .client-name label{
       color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="create-profile" id="buyWatchId">
      <div class="change-pass">
        <div class="create-profile-inside">
          <div class="top-body flex align-center space-bw align-center">
            <div class="flex admin-right">
              <p>Buy Orders</p>
            </div>
            <div id="buysellId">
              <i class="fa-solid fa-x closeAccountLimit"></i>
            </div>
          </div>
          <div class="middle-body" style="background-color: #0000ff">
            <div class="inner-middle-body flex space-bw">
              <div class="client-name">
                <label for="">Client Name</label>
                <select id="clientnameId">
                  <option value="">Select</option>
                </select>
              </div>
              <div class="client-name">
                <label for="orderType">Order Type</label>
                <select id="orderTypeId" onChange="orderTypehandler()">
                  <option value="Market">Market</option>
                  <option value="Limit">Limit</option>
                  <option value="StopLoss">Stop Loss</option>
                </select>
              </div>
              <div class="client-name">
                <label for="">Quantity</label>
                <input type="text" />
              </div>
              <div class="client-name">
                <label for="sellPrice">Sell Price</label>
                <input
                  type="number"
                  id="sellPrice"
                  disabled
                  class="sellPrices"
                />
              </div>
              <div class="submit-btn">
                <label for="" style="color: #0000ff">Submit</label>
                <input type="submit" />
              </div>
            </div>
            <div class="inner-middle-body flex space-bw">
              <div class="client-name">
                <label for="">Exchange</label>
                <select id="symbleExchange">
                  <option value="">Select</option>
                  {% for i in coin_type %}
                    <option value="{{i}}">{{i}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="client-name">
                <label for="">Symbol</label>
                <select
                  class="form-group"
                  id="symbolId"
                >
                  <option value="">Select</option>
                </select>
              </div>
              <div class="client-name">
                <label for="">LotSize</label>
                <input type="text" class="QuotationLot" disabled />
              </div>
              <div class="client-name">
                <label for="">Remark</label>
                <input type="text" />
              </div>
              <div class="cancel-finalbtn">
                <label for="" style="color: #0000ff">Cancel</label>
                <input type="submit" value="Cancel" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // socket with all handlers
      const watchbuyhandler = () => {
        $("#buyWatchId").css("display", "block")
        $('.action_dropdown').toggle();
        $("#watchPopUpId").css("display", "none")
        socket.on("connect", () => {
          console.log("Connected to the Socket.io server");
        });
      
        socket.emit("getOneData", {"identifier": JSON.parse(sessionStorage.getItem("currentCoin"))?.InstrumentIdentifier });
        socket.on("getOneDataSend", (data) => {
          console.log("data", data)
          $("#symbleExchange").val(data.Exchange);
          $("#symbolId").val(data.InstrumentIdentifier);
          $(".QuotationLot").val(data.QuotationLot);
          $(".QuotationLot").val(data.QuotationLot);
          $("#sellPrice").val(data.SellPrice);
        });
      
        socket.on("disconnect", () => {
            console.log("Disconnected from the Socket.io server");
        });
    }


      $("#symbleExchange").change((event) => {
        let symbolKey = event.target.value;
        $("#symbolId").empty();
        $("#symbolId").html("<option>Select</option>");
        response
          .filter(filterItem => filterItem?.Exchange?.toLowerCase()?.includes(symbolKey?.toLowerCase()) )
          .filter(remove => !identifier?.includes(remove?.InstrumentIdentifier))
          .map(item => {
            $("#symbolId").append(`<option>${item.InstrumentIdentifier}</option>`);
        })
      })


      // ------------------------

      $(document).ready(function() {
        $('#orderTypeId').change(function() {
            var selectedOption = $(this).val();
            if (selectedOption === "Market") {
                $('#sellPrice').prop('disabled', true);
            } else {
                $('#sellPrice').prop('disabled', false);
            }
        });
      });

              $("#buysellId").click(() =>
                $("#buyWatchId").css("display", "none")
              );

            {% if request.user.user_type != "Client" %}
              axios.get(`{% url "get-client-api" %}`, {headers: { "X-CSRFToken": "{{ csrf_token }}" }})
              .then(res => {
                  res.data.user_client.map(item => {

                      $("#clientnameId").append(`<option value=${item.id}>${item.user_name}</option>`)
                  })
              }).catch(err=> console.log("err", err))
          {% endif %}




          const toggleMenuOption = (itemString) => {
            const item = JSON.parse(unescape(itemString));
            sessionStorage.setItem("currentCoin", JSON.stringify(item));
            $("#watchPopUpId").css("display", "block");
            $('.action_dropdown').toggle();
            console.log("====", item);
          }
    </script>
  </body>
</html>
